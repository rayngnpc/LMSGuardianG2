#!/bin/bash
# Server Deployment Guide for LMS Guardian

echo "üöÄ LMS Guardian Server Deployment Guide"
echo "========================================"

echo "üìã STEP 1: Install Dependencies on Server"
echo "  sudo apt update && sudo apt upgrade -y"
echo "  sudo apt install python3 python3-pip postgresql postgresql-contrib nodejs npm -y"
echo "  pip3 install -r requirements.txt"

echo ""
echo "üóÑÔ∏è STEP 2: Setup PostgreSQL Database"
echo "  sudo -u postgres psql"
echo "  CREATE DATABASE lmsguardian;"
echo "  CREATE USER your_db_username WITH PASSWORD 'your_secure_password';"
echo "  GRANT ALL PRIVILEGES ON DATABASE lmsguardian TO your_db_username;"
echo "  \\q"

echo ""
echo "üìÅ STEP 3: Initialize Database Schema"
echo "  psql -h localhost -U your_db_username -d lmsguardian -f schema.sql"

echo ""
echo "üîß STEP 4: Configure Environment Variables"
echo "  üîí SECURITY: Never commit real credentials to version control!"
echo "  cp .env.example .env"
echo "  nano .env  # Update with your actual credentials:"
echo "    - MOODLE_USERNAME: Your LMS username"
echo "    - MOODLE_PASSWORD: Your LMS password"
echo "    - DATABASE_URL: Your PostgreSQL connection string"
echo "    - GOOGLE_SAFE_KEY: Your Google Safe Browsing API key"
echo "    - EMAIL_USER/EMAIL_PASS: Your email credentials for reports"
echo "  chmod 600 .env  # Secure the environment file"

echo ""
echo "üï∑Ô∏è STEP 5: Test the System"
echo "  # Start the backend API"
echo "  cd /path/to/LMSGuardianv2"
echo "  python -m uvicorn app.main:app --host 0.0.0.0 --port 8000"
echo ""
echo "  # In another terminal, run the scraper"
echo "  python scraper/main.py"

echo ""
echo "üîÑ STEP 6: Setup Automated Scheduling (Optional)"
echo "  # Add to crontab for daily scraping at 2 AM"
echo "  0 2 * * * cd /path/to/LMSGuardianv2 && python scraper/main.py"

echo ""
echo "‚úÖ DEPLOYMENT CHECKLIST:"
echo "  ‚ñ° PostgreSQL installed and configured"
echo "  ‚ñ° Database created using schema.sql"
echo "  ‚ñ° Dependencies installed from requirements.txt"
echo "  ‚ñ° .env file updated for server environment"
echo "  ‚ñ° Backend API tested (http://server:8000/docs)"
echo "  ‚ñ° Scraper tested with AUTO_DISCOVER_COURSES=true"
echo "  ‚ñ° Email reports tested"
echo "  ‚ñ° Firewall configured (ports 8000, 5432)"
